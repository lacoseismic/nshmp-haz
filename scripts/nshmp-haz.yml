version: "3.7"

# General deployment config
x-app: &app
  image: ${REGISTRY}/nshmp-haz-ws:${CI_COMMIT_REF_SLUG}
  deploy:
    restart_policy:
      condition: any
      delay: 5s
      max_attempts: 3
      window: 120s
    replicas: 1
    update_config:
      order: start-first
      parallelism: 1
  ports:
    - 8080

services:
  # Deploy nshmp-haz with CONUS-2018
  nshmp-haz-conus-2018:
    <<: *app
    environment:
      MODEL: CONUS-2018
      CONTEXT_PATH: /nshmp/ws/conus-2018

  # # Deploy nshmp-haz with CONUS-2014
  # nshmp-haz-conus-2014:
  #   <<: *app
  #   environment:
  #     RUN_HAZARD: 'false'
  #     MODEL: CONUS-2014
  #     CONTEXT_PATH: nshmp/conus-2014

  # # Deploy nshmp-haz with CONUS-2014B
  # nshmp-haz-conus-2014b:
  #   <<: *app
  #   environment:
  #     RUN_HAZARD: 'false'
  #     MODEL: CONUS-2014B
  #     CONTEXT_PATH: nshmp/conus-2014b

  # # Deploy nshmp-haz with CONUS-2008
  # nshmp-haz-conus-2008:
  #   <<: *app
  #   environment:
  #     RUN_HAZARD: 'false'
  #     MODEL: CONUS-2008
  #     CONTEXT_PATH: nshmp/conus-2008

  # # Deploy nshmp-haz with HI-2020
  # nshmp-haz-hi-2020:
  #   <<: *app
  #   environment:
  #     RUN_HAZARD: 'false'
  #     MODEL: HI-2020
  #     CONTEXT_PATH: nshmp/hawaii-2020

  # # Deploy nshmp-haz with AK-2007
  # nshmp-haz-ak-2007:
  #   <<: *app
  #   environment:
  #     RUN_HAZARD: 'false'
  #     MODEL: AK-2007
  #     CONTEXT_PATH: nshmp/alaska-2007
